(window.webpackJsonp=window.webpackJsonp||[]).push([[31],{1323:function(e,t,n){"use strict";const{registerReducer:o,registerEpics:i}=n(4),r=n(1380),s=n(2253),{courseAttainmentSetupEpic:a,attainmentComponentCompletedEpic:c,attainmentAchievementComponentCompletedEpic:l,attainmentCompletionEpic:m,registerTrackingMapEpic:p,setVariableOnProgressChangedEpic:u}=n(2254);o("courseAttainment",s),i(a,c,l,m,p,u,r("courseAttainment"))},1380:function(e,t,n){"use strict";const o=n(8),{Observable:i}=n(5),{setLocationReadyState:r,PUSH_LOCATION:s}=n(9),a=n(219),c=n(217);e.exports=(e,t)=>(n,l)=>n.filter(({type:t})=>{if(t!==s)return;const{navigationStatus:n,path:o}=l.getState().location;return"plugin"===n&&o[0]===e}).switchMap(()=>{const n=l.getState(),{device:s,course:m}=n;let p;if(p=t?t(n):o(m,["_"+e,"_heroImage"]),!p||!p._graphic)return i.empty();const u=a(p._graphic.src,p._graphic.srcAdvanced,!0);return u?i.concat(i.of(r(!1)),i.bindCallback(c)(u,!1).map(()=>r(!0))):i.empty()})},1383:function(e,t,n){"use strict";const o=n(8),{store:i}=n(4);e.exports=function(e,t,n){const{course:r,theme:s}=i.getState(),a=r[e],c=o(a,t),l=o(s,["_extensions",e,"_settings",t]);return c||l||n}},2253:function(e,t,n){"use strict";const o=n(31),i=n(491),r=n(11),{SETUP_APP:s}=n(9),{RESTORE_EXTENSION:a}=n(87),{COURSE_ATTAINMENT_COMPONENT_COMPLETED:c,COURSE_ATTAINMENT_ACHIEVEMENTS_UPDATED:l}=n(487),m={_isComplete:!1,_progress:0,contentCount:0};function p(e,{components:t,blocks:n,achievements:r}){switch(e._attainmentMethod){case"components":return function({_shouldUseCorrectQuestions:e},t){const n=o(t,e=>e._courseAttainment&&e._courseAttainment._isEnabled);if(!n.length)return!1;const i=o(n,t=>!!t._isComplete&&!(e&&t._isQuestionType&&!t._isCorrect));return{_isComplete:n.length===i.length,_progress:100/n.length*i.length,contentCount:n.length}}(e,t);case"blocks":return function(e,t){const n=o(e,e=>e._courseAttainment&&e._courseAttainment._isEnabled);if(!n.length)return!1;const r=o(n,e=>i(e._childrenIds,e=>t[e]._isComplete));return{_isComplete:n.length===r.length,_progress:100/n.length*r.length,contentCount:n.length}}(n,t);case"points":return function({_attainmentAttributes:e},t){const n=t&&t._points;return n&&n._isEnabled&&e?{_isComplete:n._currentPoints>=e,_progress:100/e*n._currentPoints}:{_isComplete:!1,_progress:0,contentCount:e}}(e,r);case"stars":return function({_attainmentAttributes:e},t){const n=t&&t._stars;return n&&n._isEnabled&&e?{_isComplete:n._currentStarsCollected>=e,_progress:100/e*n._currentStarsCollected}:{_isComplete:!1,_progress:0,contentCount:e}}(e,r);default:return{_isComplete:!1,_progress:0}}}e.exports=(e=m,t)=>{if(t.type===s){const n=t.payload.course._courseAttainment;return n&&n._isEnabled?r({},e,n,p(n,t.payload)):m}if(!e._isEnabled)return m;if(e._isComplete)return e;switch(t.type){case c:return"points"===e._attainmentMethod||"stars"===e._attainmentMethod?e:r({},e,p(e,t.payload));case l:return"components"===e._attainmentMethod||"blocks"===e._attainmentMethod?e:r({},e,p(e,t.payload));case a:if("courseAttainment"===t.payload.extensionName)return r({},e,t.payload.extensionData);default:return e}}},2254:function(e,t,n){"use strict";const o=n(8),i=n(11),{Observable:r}=n(5),{SETUP_APP:s}=n(9),{COMPONENT_COMPLETED:a,UPDATE_COMPONENTS:c}=n(61),{addElement:l}=n(42),{addPrompt:m}=n(97),{NavigationSideItem:p}=n(475),{updateVariable:u}=n(50),d=n(1383),{registerTrackingMap:_}=n(4),h=n(2255),{COURSE_ATTAINMENT_COMPONENT_COMPLETED:g,COURSE_ATTAINMENT_ACHIEVEMENTS_UPDATED:E,attainmentComponentCompleted:C,attainmentAchievementComponentCompleted:A,attainmentComplete:y}=n(487),f=n(2256);t.courseAttainmentSetupEpic=(e,t)=>e.filter(e=>{const n=t.getState();if(e.type!==s)return!1;const{courseAttainment:o}=n;return o&&o._isEnabled&&o._isComplete&&!o._shouldHideSummaryAndIcon}).map(()=>{const e=t.getState(),{courseAttainment:n}=e;return l({parent:"navigationSide",name:"courseAttainment",component:p,props:{link:"/courseAttainment",icon:d("_courseAttainment","_navigationIcon","license2"),label:n.title}})}),t.registerTrackingMapEpic=(e,t)=>e.filter(e=>{const n=t.getState();if(e.type!==s)return!1;const{courseAttainment:o}=n;return o&&o._isEnabled}).do(()=>{_("courseAttainment",f,"extensions")}).ignoreElements(),t.attainmentComponentCompletedEpic=(e,t)=>e.filter(e=>{const n=t.getState();if(!n.app.isDataReady||e.type!==a)return!1;const{courseAttainment:o}=n;return o&&o._isEnabled}).map(()=>{const e=i({},t.getState());return e._prevIsComplete=e.courseAttainment._isComplete,C(e)}),t.attainmentAchievementComponentCompletedEpic=(e,t)=>e.filter(e=>{const n=t.getState();if(!n.app.isDataReady||"ACHIEVEMENTS_COMPONENT_COMPLETED"!==e.type)return!1;const{courseAttainment:o}=n;return o&&o._isEnabled}).map(()=>{const e=i({},t.getState());return e._prevIsComplete=e.courseAttainment._isComplete,A(e)}),t.setVariableOnProgressChangedEpic=(e,t)=>e.ofType(g,E,s,c).filter(()=>{const{app:e,courseAttainment:n,course:{_courseAttainment:o}}=t.getState();return e.hasAppStarted&&n._isEnabled&&o._canSaveToVariable&&o._variableId}).map(()=>Math.floor(t.getState().courseAttainment._progress)).distinctUntilChanged().map(e=>{const{course:{_courseAttainment:n}}=t.getState();return u(n._variableId,e,n._variableUpdateType)}),t.attainmentCompletionEpic=(e,t)=>e.ofType(g,E).mergeMap(e=>{const n=e.payload._prevIsComplete,{theme:i,courseAttainment:s}=t.getState();if(n!==s._isComplete&&s._isComplete){const e=[y()];if(s._shouldHideNotificationPopup||e.push(m(function(e,t){let n={};e._shouldCloseWindowOnCourseAttained?(n={title:e.completionNotifyTitle,body:e.completionNotifyBody,_action:{text:e.closeWindowText,onClick:()=>{window._exitCourse()}}},e._shouldHidePromptDismissButton&&(n._dismiss={_isHidden:!0})):(n={title:e.completionNotifyTitle,body:e.completionNotifyBody},e._shouldHideSummaryAndIcon||(n._action={text:e.completionTitle,_link:{_link:"courseAttainment",_linkType:"extensions"}}));const i=o(e,"_notifyIcon"),r=o(t,"_extensions._courseAttainment._settings._notifyIcon"),s=i||r;return s&&(n._glyph={_type:"icon",_icon:s}),n}(s,i))),s._shouldHideSummaryAndIcon||(e.push(l({parent:"navigationSide",name:"courseAttainment",component:p,props:{link:"/courseAttainment",icon:d("_courseAttainment","_navigationIcon","license2"),label:s.title}})),e.push(l({parent:"router",name:"courseAttainment",path:"/courseAttainment",exact:!0,component:h}))),e.length)return r.of(...e)}return r.empty()})},2255:function(e,t,n){"use strict";const o=n(2),i=n(1),r=n(0),{connect:s}=n(6),a=n(7),c=n(30),l=n(76),m=n(467),{ContentContainer:p,HeroImage:u}=n(301),d=n(172),_=n(40),h=o({displayName:"CourseAttainment",propTypes:{courseAttainment:i.shape({title:i.string,completionBody:i.string,ariaLabel:i.string,_heroImage:i.object,_headerIcon:i.string}).isRequired,theme:i.object.isRequired,isReady:i.bool.isRequired},renderTitle(){if(this.props.courseAttainment.title)return r.createElement(l,{headingElement:"h"+this.context,displayTitle:this.props.courseAttainment.title,className:"ev-course-attainment-header-title ev-header-title",innerClassName:"ev-course-attainment-header-title-inner ev-header-title-inner"})},renderContent(){if(this.props.courseAttainment.completionBody)return r.createElement(m,null,r.createElement(c,{className:"ev-component-body",innerClassName:"ev-component-body-inner",body:this.props.courseAttainment.completionBody}))},renderHeroImage(){const{_heroImage:e}=this.props.courseAttainment;if(null!=e&&e._isEnabled)return r.createElement(_.Provider,{value:this.props.courseAttainment.title?this.context+1:this.context},r.createElement(u,{title:e.title,body:e.body,graphic:e._graphic,_contentWidth:e._contentWidth,layout:e.layout,floatingGraphic:e._floatingGraphic,parentSelector:".ev-extension-hero-container",theme:this.props.theme,isReady:this.props.isReady}))},render(){var e,t;const{courseAttainment:n,theme:o,isReady:i}=this.props,s=n._headerIcon,c=null===(e=o._extensions._courseAttainment)||void 0===e||null===(t=e._settings)||void 0===t?void 0:t._headerIcon,l=s||c;return r.createElement(p,{region:"course attainment",className:"ev-extension ev-course-attainment",ariaLabel:n.ariaLabel},r.createElement("div",{className:"ev-course-attainment-inner ev-extension-inner"},i?null:r.createElement(d,null),r.createElement("div",{className:"ev-extension-hero-container"},this.renderHeroImage()),r.createElement("div",{className:"ev-header"},r.createElement("div",{className:a("ev-header-inner ev-clearfix",{"ev-no-graphic":!l})},r.createElement("div",{className:"ev-header-left"},this.renderTitle()),l&&r.createElement("div",{className:"ev-header-right"},r.createElement("i",{className:"ev-icon ev-icon-"+l})))),this.renderContent()))}});h.contextType=_,e.exports=s(e=>({courseAttainment:e.courseAttainment,theme:e.theme,isReady:e.location.isLocationReady}))(h)},2256:function(e,t,n){"use strict";e.exports={_isComplete:{fieldKey:"_isComplete",type:"Boolean",shouldRestore:!0},_progress:{fieldKey:"_progress",type:"Number",shouldRestore:!0}}}}]);