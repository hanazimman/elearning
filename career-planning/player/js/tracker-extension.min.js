(window.webpackJsonp=window.webpackJsonp||[]).push([[102],{1339:function(e,t,r){"use strict";const{registerEpics:a,registerReducer:c}=r(4),n=r(2354),{trackerWindowUnloadEpic:i,trackerSetupEpic:o,trackerLoadDataEpic:s,trackerLoadTrackingEpic:p,trackerTrackEpic:_,trackerTrackDevEpic:l}=r(2355);c("tracker",n),a(i,o,s,p,_,l)},1401:function(e,t,r){"use strict";t.TRACKER_LOAD_DATA="TRACKER_LOAD_DATA",t.TRACKER_SAVE_SESSION="TRACKER_SAVE_SESSION",t.SET_TRACKER_AUTH="SET_TRACKER_AUTH",t.SAVE_TRACKER_DONE="SAVE_TRACKER_DONE",t.trackerLoadData=e=>({type:t.TRACKER_LOAD_DATA,payload:e}),t.trackerSaveSession=e=>({type:t.TRACKER_SAVE_SESSION,payload:e}),t.setTrackerAuth=e=>({type:t.SET_TRACKER_AUTH,payload:e}),t.saveTrackingDone=e=>({type:t.SAVE_TRACKER_DONE,payload:e})},2354:function(e,t,r){"use strict";const a=r(11),{FETCH_COURSE_DATA:c}=r(9),{SET_TRACKER_AUTH:n}=r(1401),i={_isEnabled:!1,_auth:{}};e.exports=(e=i,t)=>t.type===c&&t.payload.config._tracker&&t.payload.config._tracker._isEnabled?a({},e,{_isEnabled:!0}):e._isEnabled?t.type===n?a({},e,t.payload):e:i},2355:function(e,t,r){"use strict";(function(e){const{Observable:a}=r(5),c=r(8),n=r(0),{ajax:i}=r(227),o=r(4),s=r(2),{addElement:p}=r(42),{adjustNavigationHeight:_}=r(324),{COMPONENT_COMPLETED:l,COMPONENT_TRACKABLE_CHANGE:u}=r(61),{TRACKABLE_CHANGE:E}=r(87),{WINDOW_UNLOAD:d,WINDOW_BEFORE_UNLOAD:g}=r(123),{DATA_READY:k,APP_STARTED:A,setAppReadyState:T,setLearner:f}=r(9),{setTracking:S,getTrackingImmediately:R}=r(486),{trackerLoadData:y,trackerSaveSession:m,setTrackerAuth:C,saveTrackingDone:D,TRACKER_LOAD_DATA:w,TRACKER_SAVE_SESSION:O,SET_TRACKER_AUTH:v}=r(1401);let b=null;function N(e,t){const{config:r,tracker:n}=t.getState();switch(r._tracker._platform){case"exceed":return function(e,t,r){if(r){const r=`${t._pushData}/${b}`;return i.put(r,e,{"Content-Type":"application/json"}).catch(e=>(console.log("tracker:error",e),a.empty()))}return a.empty()}(e,r._tracker,n.authenticated);default:return function(e,t){const r=e._user,a=e._course,n=`${t._pushData}/${r}/${a}`;return i.put(n,e,{"Content-Type":"application/json"}).catch(e=>{c(e,"response._isLoginRequired",!1)&&window.location.reload()})}(e,r._tracker)}}t.trackerSetupEpic=(e,t)=>e.filter(e=>{if(e.type!==k)return!1;const{app:r,config:a}=t.getState(),c=a._tracker;return!r.isLivePreview&&c&&c._isEnabled}).take(1).mergeMap(()=>a.of(T("tracker",!1),y())).catch(e=>(console.warn("Tracker extension error: ",e),T("tracker",!0))),t.trackerLoadDataEpic=(t,r)=>t.ofType(w).mergeMap(()=>{const{config:t}=r.getState(),l=t._tracker;switch(l._platform){case"exceed":return function(e,t){const{inline:r}=t.getState(),n=function(e,t){if(t){return c(window,"evolve.courseId")}e=e.replace(/[[]/,"\\[").replace(/[\]]/,"\\]");const r=new RegExp(`[\\?&]${e}=([^&#]*)`).exec(window.location.search);return null===r?"":decodeURIComponent(r[1].replace(/\+/g," "))}("_courseId",r.isEnabled);n||window.location.replace("/404");return a.forkJoin(i.getJSON(`${e._auth}?course_id=${n}`),i.getJSON("/monitor/heartbeat")).mergeMap(([e,t])=>{if(e.authenticated){const r=1e3*t,c=(new Date).getTime();window.TIME_DIFFERENCE=c-r;const{user_id:n,first_name:i,last_name:o}=e;return a.of(f({_id:n,firstName:i,lastName:o,userData:e}),C(e))}return a.of(C({authenticated:!1}))}).catch(e=>{console.log("error",e)})}(l,r);default:return function(t,r){return a.bindCallback(e.getScript)("../../bloom/bloomAPI.js").mergeMap(()=>{if(window.BLOOM_API)return a.bindCallback(window.BLOOM_API.init)({store:r,actions:{addElement:p,adjustNavigationHeight:_,trackerSaveSession:m},libraries:{React:n,Observable:a,createReactClass:s},player:o})}).mergeMap(()=>i.getJSON(t._auth)).mergeMap(e=>a.of(C(e))).catch(e=>{console.log("error",e)})}(l,r)}}),t.trackerTrackEpic=(e,t)=>e.filter(e=>{const{app:r,config:a}=t.getState();if(e.type===l||e.type===u||e.type===A||e.type===O||e.type===E){const e=a._tracker;return!r.isLivePreview&&e&&e._isEnabled}return!1}).do(({type:e})=>console.log("tracker:trigger",e)).debounce(({type:e})=>a.timer(e===O?0:5e3)).takeUntil(e.ofType(d,g)).switchMap(()=>N(R(),t).catch(e=>(console.log("tracker:error",e),a.empty()))).map(()=>D()).do(()=>console.log("tracker:saved")),t.trackerWindowUnloadEpic=(e,t)=>e.ofType(d,g).take(1).filter(()=>{const{app:e,config:r,inline:a}=t.getState(),c=r._tracker,n=null==a?void 0:a.isEnabled;return!e.isLivePreview&&n&&c&&c._isEnabled}).mergeMap(()=>N(R(),t)).map(()=>D()),t.trackerTrackDevEpic=(e,t)=>e.filter(e=>{const{app:r,tracking:a}=t.getState();return(e.type===l||e.type===u||e.type===A||e.type===d||e.type===O||e.type===E)&&(r.isLivePreview&&a._isTrackingDevLogEnabled)}).mergeMap(e=>(console.log("TRACKER - action type:"+e.type,R()),a.empty())),t.trackerLoadTrackingEpic=(t,r)=>t.ofType(v).mergeMap(()=>{const{config:t}=r.getState();switch(t._tracker._platform){case"exceed":return function(t){const{config:r,tracker:c}=t.getState();if(c.authenticated&&c.enrollment_course_activity_id&&c.user_id){b=c.enrollment_course_activity_id;const l=`/evolve/api/v1/enrollment_course_activities/${b}/decorator.js`;return a.bindCallback(e.getScript)(l).mergeMap(()=>{if(window.EXCEED_API)return a.bindCallback(window.EXCEED_API.init)({store:t,actions:{addElement:p,adjustNavigationHeight:_,trackerSaveSession:m},libraries:{React:n,Observable:a,createReactClass:s},player:o})}).mergeMap(()=>{const e=`${r._tracker._getData}/${b}`;return i.getJSON(e)}).mergeMap(e=>(S(e,!0),a.of(T("tracker",!0))))}return a.of(T("tracker",!0))}(r);default:return function(e){const{config:t,tracker:r}=e.getState(),c=t._courseId,n=`${t._tracker._getData}/${r._user._id}/${c}`;return i.getJSON(n).mergeMap(e=>{S(e,!0);const{_id:t,firstName:c,lastName:n}=r._user;return a.of(T("tracker",!0),f({_id:t,firstName:c,lastName:n}))})}(r)}})}).call(this,r(27))}}]);